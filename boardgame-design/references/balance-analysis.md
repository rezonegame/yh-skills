# Balance Analysis Framework

游戏平衡性分析的完整框架，包含经济系统、策略多样性、玩家数扩展等分析工具。

---

## Overview

平衡性分析的目标是确保游戏：
1. **多种可行策略** - 没有单一必胜策略
2. **玩家数扩展性** - 不同人数下都平衡
3. **资源经济健康** - 无资源溢出或匮乏
4. **追赶机制** - 落后玩家有机会追赶
5. **第一玩家公平** - 无显著先后手优势

---

## 1. Economic Balance Analysis

### Resource Flow Analysis

```python
def analyze_economy(playtest_data):
    """
    分析游戏经济系统的平衡性

    检查项：
    1. 资源增长速度是否过快/过慢
    2. 稀缺性是否随游戏推进变化
    3. 是否有资源溢出/浪费
    4. 领跑者是否有雪球效应
    """
    return {
        "growth_rate": calculate_growth_rate(),
        "scarcity_curve": calculate_scarcity_over_time(),
        "waste_ratio": calculate_waste_percentage(),
        "snowball_effect": check_leader_advantage()
    }
```

### Economic Health Indicators

```yaml
正常指标:
  资源增长率: 5-15% per round
  稀缺性维持: 70-90% of game
  浪费率: < 10%
  领跑者优势: < 20%

警告指标:
  资源增长率: > 20% (通胀) 或 < 3% (停滞)
  稀缺性: < 50% (资源过剩) 或 > 95% (资源枯竭)
  浪费率: > 20%
  领跑者优势: > 30%
```

### Snowball Effect Detection

```
测试方法：
1. 记录每回合每位玩家的资源/分数
2. 计算领先者的领先幅度随回合的变化
3. 检查是否呈指数增长

正常模式：
回合 1: P1领先 10%
回合 3: P1领先 12%
回合 5: P1领先 15%

雪球模式：
回合 1: P1领先 10%
回合 3: P1领先 25%
回合 5: P1领先 50% ← 雪球效应！
```

---

## 2. Strategic Balance Analysis

### Strategy Win Rate Matrix

```markdown
| 策略 vs 策略 | 策略A | 策略B | 策略C | 策略D |
|-------------|-------|-------|-------|-------|
| 策略A | - | 55% | 60% | 45% |
| 策略B | 45% | - | 50% | 70% |
| 策略C | 40% | 50% | - | 55% |
| 策略D | 55% | 30% | 45% | - |

**平衡指标**：
- 所有策略平均胜率应在 45-55% 之间 ✓
- 最大胜率差 < 20% ✓
- 每个策略至少有一个克制关系 ✓

**不平衡示例**：
| 策略A | 80% | 85% | 90% | ← 主导策略！
```

### Strategy Viability Assessment

```yaml
评估维度:
  可行性: 策略是否可以执行到游戏结束
  竞争力: 策略是否能与其他策略竞争
  多样性: 策略内是否有分支选择
  反制性: 是否有其他策略可以克制

健康状态:
  每个策略:
    胜率: 45-55%
    使用率: 15-30%
    满意度: > 7/10
```

### First Player Advantage Analysis

```
测试方法：
进行多局游戏，每位玩家轮流先手

数据分析：
P1先手时胜率: 55%
P2先手时胜率: 45%
P3先手时胜率: 48%
P4先手时胜率: 52%

第一玩家优势: 55% - 48% = 7% ✓ 可接受

如果 > 15%，需要平衡机制：
- 后手补偿资源
- 行动点补偿
- 后手选择优势
```

---

## 3. Player Count Scaling

### Player Count Experience Matrix

```markdown
| 玩家数 | 游戏时长 | 交互强度 | 策略深度 | 平衡性 | 推荐度 |
|--------|----------|----------|----------|--------|--------|
| 2人 | 45min | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ✓ 推荐 |
| 3人 | 60min | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ✓✓ 最佳 |
| 4人 | 75min | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ✓ 可行 |
| 5人 | 90min | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ✗ 不推荐 |
```

### Scaling Mechanisms

```yaml
玩家数扩展机制:
  动态资源供应:
    2人: 每人 +20% 资源
    3人: 标准
    4人: 每人 -10% 资源
    5人: 每人 -20% 资源

  交互密度调整:
    2人: 增加直接冲突
    3-4人: 标准
    5+: 强制互动机制

  回合顺序补偿:
    后手玩家: 额外行动点或资源
```

### Downtime Analysis

```
目标：每位玩家的停机时间 < 游戏时长的 20%

测量：
- 玩家平均等待时间
- 最长等待时间
- 玩家参与度（非自己回合时的关注程度）

改进方法：
- 同时行动阶段
- 反应式机制（可在他人回合时行动）
- 规划阶段（他人回合时做决策）
```

---

## 4. Catch-Up Mechanisms

### Types of Catch-Up

```yaml
给予型:
  落后奖励: 给最后一名额外资源
  补偿机制: 根据分数差距给予奖励

剥夺型:
  领先惩罚: 对第一名施加限制
  进展税: 越接近胜利越困难

机会型:
  转折事件: 游戏后期的大逆转机会
  风险机制: 落后者可冒险追赶
```

### Catch-Up Balance

```
过度补偿测试：
如果落后玩家几乎总是能追上 → 补偿过强

不足补偿测试：
如果落后玩家几乎从未能追上 → 补偿不足

健康平衡：
- 落后玩家有 30-50% 的追赶成功率
- 领先玩家仍有 60-70% 的保持优势率
- 游戏结局保持悬念到最后 20% 时间
```

---

## 5. Variance and Randomness

### RNG Balance Analysis

```
随机性评估：
技能 vs 运气比例：
- 纯运气游戏: 0% skill, 100% luck
- 轻度运气: 60% skill, 40% luck ← 大多数桌游
- 重度运气: 40% skill, 60% luck

测试方法：
- 新手 vs 老手对局
- 如果老手胜率 > 70% = 技能主导 ✓
- 如果老手胜率 ≈ 50% = 运气主导
```

### Variance Control

```yaml
高方差元素:
  一次掷骰决定胜负: 避免
  单次卡牌抽取消耗游戏: 避免

控制方法:
  多次小随机而非一次大随机
  提供风险管理机制
  允许玩家影响随机结果
  随机后的决策机会
```

---

## 6. Iteration Balance Testing

### Single-Variable Testing

```
每次只调整一个数值：

测试迭代 v1.0:
- 卡牌A成本: 3资源

测试迭代 v1.1:
- 卡牌A成本: 4资源 ← 只改这个！

测试迭代 v1.2:
- 卡牌A成本: 4资源
- 卡牌B成本: 5资源 ← 又改了一个，不知道哪个有效
```

### Balance Stress Testing

```
极限测试：
1. 最小资源：玩家只有最低限资源
2. 最大资源：玩家资源溢出
3. 最小玩家数：2人
4. 最大玩家数：5-6人
5. 极端策略：全押某一种策略

观察游戏是否能正常进行
```

---

## 7. Metrics Collection

### Quantitative Balance Metrics

```yaml
经济指标:
  资源增长率: X% per round
  稀缺性曲线: [start, mid, end]
  溢出率: X%
  流通速度: X resources/round

策略指标:
  策略数量: X 种可行策略
  策略胜率: [A: 50%, B: 52%, C: 48%]
  策略转换: 平均 X 次/局
  主导策略: 无 ✓

玩家指标:
  第一玩家优势: X%
  落后追赶率: X%
  分数标准差: X points
  交互频率: X times/player/round
```

### Player Experience Metrics

```yaml
主观评分:
  策略多样性: "我觉得有X种不同玩法"
  平衡性感受: "游戏很公平/不太公平/很不公平"
  追赶机会: "落后时还能追上"
  重玩意愿: 1-10分

行为数据:
  策略转换次数
  放弃游戏时刻（如有）
  互动/冲突频率
  查询规则频率
```

---

## 8. Common Balance Issues

### Issue: Dominant Strategy

```
症状：
- 所有玩家都使用相同策略
- 其他策略胜率 < 30%
- 游戏重复性高

解决方案：
1. 削弱主导策略（增加成本或减少收益）
2. 强化其他策略（减少成本或增加收益）
3. 添加新机制来制约主导策略
4. 改变游戏条件使策略适用性变化
```

### Issue: Runaway Leader

```
症状：
- 领先者优势随回合扩大
- 胜负在游戏前期已定
- 后期无悬念

解决方案：
1. 领先者成本增加
2. 落后者补偿机制
3. 后期加速机制
4. 胜利条件延迟触发
```

### Issue: Kingmaking

```
症状：
- 某玩家决定胜负（但自己已无胜算）
- 最后一名的选择决定冠军
- 不公平的游戏结果

解决方案：
1. 隐藏关键信息
2. 所有玩家同时选择
3. 消除"自杀式攻击"的收益
4. 调整胜利条件
```

---

## 9. Balance Iteration Workflow

```
┌─────────────────────────────────────────────────────────────┐
│                     平衡性迭代流程                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 收集数据                                                 │
│     ├─ 定量指标（资源、胜率、分数）                           │
│     └─ 定性反馈（玩家感受）                                 │
│                                                             │
│  2. 分析问题                                                 │
│     ├─ 识别不平衡来源                                       │
│     ├─ 确定严重程度                                         │
│     └─ 排列优先级                                           │
│                                                             │
│  3. 设计调整                                                 │
│     ├─ 单变量调整原则                                       │
│     ├─ 计算预期影响                                         │
│     └─ 设置测试标准                                         │
│                                                             │
│  4. 测试验证                                                 │
│     ├─ 进行 playtest                                        │
│     ├─ 收集新数据                                           │
│     └─ 对比调整前后                                         │
│                                                             │
│  5. 迭代或接受                                               │
│     ├─ 如果改善 → 继续迭代其他问题                          │
│     ├─ 如果无效 → 尝试不同调整                              │
│     └─ 如果恶化 → 回滚并重新分析                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 10. Balance Declaration Criteria

```markdown
## 游戏平衡性完成的条件

经济平衡:
- [ ] 无资源溢出或匮乏
- [ ] 无雪球效应（< 20% 领先优势扩大）
- [ ] 浪费率 < 10%

策略平衡:
- [ ] 至少 3 种可行策略
- [ ] 所有策略胜率在 45-55%
- [ ] 无主导策略

玩家数平衡:
- [ ] 推荐玩家数范围内都平衡
- [ ] 第一玩家优势 < 15%
- [ ] 落后玩家有 30%+ 追赶率

体验平衡:
- [ ] 重玩意愿 > 60%
- [ ] 公平性评分 > 7/10
- [ ] 无明显抱怨
```

---

**See Also:**
- `playtest-framework.md` - 测试数据收集
- `iteration-testing.md` - 迭代方法论
- `5-component-rubric.md` - 5组件评估
